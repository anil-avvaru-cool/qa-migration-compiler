# 1.1 IR Model Enhancement Implementation Plan

**Date**: February 22, 2026
**Project**: QA Migration Compiler
**Objective**: Refactor IR models to support enhanced JSON schema

## Analysis Summary

### Current State
- Basic Pydantic models with minimal fields
- Generic dict-based structures
- Single basic metadata per entity
- No support for selector strategies, data binding, or detailed assertions

### Target State
- Rich JSON schema with version tracking
- Selector strategy support with stability scores
- Data binding and parameterization
- Comprehensive step and assertion models
- Separate files for each entity type

## Implementation Scope

### Phase 1: Model Enhancements
1. **project.py** - Add irVersion, sourceFramework, targetFramework, architecturePattern, supportsParallel
2. **environment.py** - Add baseUrls dict, executionMode, browsers list, timeouts dict, retryPolicy
3. **targets.py** - Add context, semantic, selectorStrategies, preferredStrategy
4. **data.py** - Add dataSetId, type, records array with schema
5. **test.py** - Enhance steps with action/target/input, add assertions with source binding
6. **suite.py** - Add description field

### Phase 2: Builder Updates
- Update all IR builders to populate new fields
- Implement stability score calculation for selectors
- Wire data binding logic

### Phase 3: Testing
- Comprehensive unit tests for each model
- Integration tests for JSON generation
- Validation of test data files

## Key Design Decisions

1. **Modular JSON**: Separate files per entity type for maintainability
2. **Data Binding**: Use `{ "source": "data|ui", "field": "fieldname" }` pattern
3. **Stability Scoring**: Calculate based on selector specificity
4. **No Backward Compatibility**: Full refactoring to new schema
5. **JSON Schema Validation**: Ready for future validation layer

## Risks & Mitigations

| Risk | Mitigation |
|------|-----------|
| Breaking existing code | Models are internal; builders isolate impact |
| Test failures | Comprehensive test coverage before release |
| Data binding complexity | Clear separation of concerns in step model |

## Success Criteria

- [ ] All models updated and validate with Pydantic
- [ ] All builders produce correct JSON output
- [ ] 100+ unit tests pass
- [ ] Full integration test passes
- [ ] Sample JSON files match target specification
